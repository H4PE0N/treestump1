
SOURCE_FOLDER := ../Source-Files-Folder
OBJECT_FOLDER := ../Object-Files-Folder
BINARY_FOLDER := ../Binary-Files-Folder

ENGINE_FOLDER := $(SOURCE_FOLDER)/Chess-Engine-Folder
CONSOLE_FOLDER := $(SOURCE_FOLDER)/Game-Console-Folder
MASTER_FOLDER := $(SOURCE_FOLDER)/Game-Master-Folder
SCREEN_FOLDER := $(SOURCE_FOLDER)/Game-Screen-Folder
SOCKET_FOLDER := $(SOURCE_FOLDER)/Game-Socket-Folder

ENGINE_SOURCE := $(ENGINE_FOLDER)/Source-Files-Folder
ENGINE_HEADER := $(ENGINE_FOLDER)/Header-Files-Folder

CONSOLE_SOURCE := $(CONSOLE_FOLDER)/Source-Files-Folder
CONSOLE_HEADER := $(CONSOLE_FOLDER)/Header-Files-Folder

SCREEN_SOURCE := $(SCREEN_FOLDER)/Source-Files-Folder
SCREEN_HEADER := $(SCREEN_FOLDER)/Header-Files-Folder

SOCKET_HEADER := $(SOCKET_FOLDER)/Header-Files-Folder
SOCKET_SOURCE := $(SOCKET_FOLDER)/Source-Files-Folder


ENGINE_SOURCES := $(wildcard $(ENGINE_SOURCE)/*.c)
ENGINE_HEADERS := $(wildcard $(ENGINE_HEADER)/*.h)

CONSOLE_SOURCES := $(wildcard $(CONSOLE_SOURCE)/*.c)
CONSOLE_HEADERS := $(wildcard $(CONSOLE_HEADER)/*.h)

SCREEN_SOURCES := $(wildcard $(SCREEN_SOURCE)/*.c)
SCREEN_HEADERS := $(wildcard $(SCREEN_HEADER)/*.h)

SOCKET_SOURCES := $(wildcard $(SOCKET_SOURCE)/*.c)
SOCKET_HEADERS := $(wildcard $(SOCKET_HEADER)/*.h)


ENGINE_OBJECTS := $(patsubst $(ENGINE_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(ENGINE_SOURCES))
SCREEN_OBJECTS := $(patsubst $(SCREEN_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(SCREEN_SOURCES))
SOCKET_OBJECTS := $(patsubst $(SOCKET_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(SOCKET_SOURCES))
CONSOLE_OBJECTS := $(patsubst $(CONSOLE_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(CONSOLE_SOURCES))


COMPILE_COMPILOR := gcc
COMPILE_FLAGS := -Wall -Werror

SDL_LIB_FLAGS := -lSDL2main -lSDL2 -lSDL2_image
SDL_DIR_FLAGS := -ISDL2/include -LSDL2/lib

WIN_SDL_FLAGS := $(SDL_DIR_FLAGS) -lmingw32 $(SDL_LIB_FLAGS)
LIN_SDL_FLAGS := `sdl2-config --libs --cflags` $(SDL_LIB_FLAGS)

WIN_SOC_FLAGS := -lws2_32
LIN_SOC_FLAGS :=

STD_EXE_FLAGS := -O0 -lm
CON_EXE_FLAGS :=
SOC_EXE_FLAGS := $(LIN_SOC_FLAGS)
SDL_EXE_FLAGS := $(LIN_SDL_FLAGS)


.PRECIOUS: $(OBJECT_FILES)


CON_FILES := engine-console single-console multi-console debugging
SDL_FILES := single-screen multi-screen
CON_SOC_FILES := engine-socket client-console server-console
SDL_SOC_FILES := client-screen server-screen

EXE_FILES := $(CON_FILES) $(SDL_FILES) $(CON_SOC_FILES) $(SDL_SOC_FILES)


$(CON_FILES): %: $(OBJECT_FOLDER)/%.o $(ENGINE_OBJECTS) $(CONSOLE_OBJECTS) \
	$(MASTER_FOLDER)/%.c $(ENGINE_SOURCES) $(ENGINE_HEADERS) $(CONSOLE_SOURCES) $(CONSOLE_HEADERS)
	$(COMPILE_COMPILOR) $(ENGINE_OBJECTS) $(CONSOLE_OBJECTS) $(OBJECT_FOLDER)/$@.o $(COMPILE_FLAGS) $(STD_EXE_FLAGS) $(CON_EXE_FLAGS) -o $@

$(SDL_FILES): %: $(OBJECT_FOLDER)/%.o $(ENGINE_OBJECTS) $(SCREEN_OBJECTS) \
	$(MASTER_FOLDER)/%.c $(ENGINE_SOURCES) $(ENGINE_HEADERS) $(SCREEN_SOURCES) $(SCREEN_HEADERS)
	$(COMPILE_COMPILOR) $(ENGINE_OBJECTS) $(SCREEN_OBJECTS) $(OBJECT_FOLDER)/$@.o $(COMPILE_FLAGS) $(STD_EXE_FLAGS) $(SDL_EXE_FLAGS) -o $@

$(CON_SOC_FILES): %: $(OBJECT_FOLDER)/%.o $(ENGINE_OBJECTS) $(CONSOLE_OBJECTS) $(SOCKET_OBJECTS) \
	$(MASTER_FOLDER)/%.c $(ENGINE_SOURCES) $(ENGINE_HEADERS) $(CONSOLE_SOURCES) $(CONSOLE_HEADERS) $(SOCKET_SOURCES) $(SOCKET_HEADERS)
	$(COMPILE_COMPILOR) $(ENGINE_OBJECTS) $(CONSOLE_OBJECTS) $(SOCKET_OBJECTS) $(OBJECT_FOLDER)/$@.o $(COMPILE_FLAGS) $(STD_EXE_FLAGS) $(CON_EXE_FLAGS) $(SOC_EXE_FLAGS) -o $@

$(SDL_SOC_FILES): %: $(OBJECT_FOLDER)/%.o $(ENGINE_OBJECTS) $(SOCKET_OBJECTS) $(SCREEN_OBJECTS) \
	$(MASTER_FOLDER)/%.c $(ENGINE_SOURCES) $(ENGINE_HEADERS) $(SOCKET_SOURCES) $(SOCKET_HEADERS) $(SCREEN_SOURCES) $(SCREEN_HEADERS)
	$(COMPILE_COMPILOR) $(ENGINE_OBJECTS) $(SOCKET_OBJECTS) $(SCREEN_OBJECTS) $(OBJECT_FOLDER)/$@.o $(COMPILE_FLAGS) $(STD_EXE_FLAGS) $(SOC_EXE_FLAGS) $(SDL_EXE_FLAGS) -o $@


$(OBJECT_FOLDER)/%.o: $(MASTER_FOLDER)/%.c
	$(COMPILE_COMPILOR) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(ENGINE_SOURCE)/%.c $(ENGINE_HEADER)/%.h
	$(COMPILE_COMPILOR) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(SCREEN_SOURCE)/%.c $(SCREEN_HEADER)/%.h
	$(COMPILE_COMPILOR) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(SOCKET_SOURCE)/%.c $(SOCKET_HEADER)/%.h
	$(COMPILE_COMPILOR) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(CONSOLE_SOURCE)/%.c $(CONSOLE_HEADER)/%.h
	$(COMPILE_COMPILOR) $< -c $(COMPILE_FLAGS) -o $@


FILES_TARGET := files
CLEAN_TARGET := clean

REMOVE_CMD := rm
REMOVE_FLAGS :=

$(FILES_TARGET):
	@echo $(foreach FILE, $(EXE_FILES), $(FILE))

$(CLEAN_TARGET):
	$(REMOVE_CMD) $(REMOVE_FLAGS) $(OBJECT_FOLDER)/*.o $(EXE_FILES)
